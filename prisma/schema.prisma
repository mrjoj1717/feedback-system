generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// ============= Business Model =============
model Business {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  name              String
  slug              String   @unique
  email             String?
  whatsappPhone     String?
  complaintPhone    String?  // â¬…ï¸ Ø¬Ø¯ÙŠØ¯ - Ø±Ù‚Ù… Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰
  googlePlaceId     String?
  googleReviewUrl   String?
   
  // Ø§Ù„ØªØ®ØµÙŠØµ - Ø¬Ø¯ÙŠØ¯ ğŸ¨
  logo              String?  @default("")
  primaryColor      String   @default("#F59E0B")
  secondaryColor    String   @default("#3B82F6")
  backgroundColor   String   @default("#FFFFFF")
  
  totalViews        Int      @default(0)
  totalFeedback     Int      @default(0)
  averageRating     Float    @default(0)
  
  rating1           Int      @default(0)
  rating2           Int      @default(0)
  rating3           Int      @default(0)
  rating4           Int      @default(0)
  rating5           Int      @default(0)
  
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
  rewardsEnabled    Boolean  @default(true)
  
  // ØªÙ‚ÙŠÙŠÙ… 5 Ù†Ø¬ÙˆÙ…
  reward5Type       String   @default("percentage_discount")
  reward5Value      String   @default("15")
  reward5Details    String?
  
  // ØªÙ‚ÙŠÙŠÙ… 4 Ù†Ø¬ÙˆÙ…
  reward4Type       String   @default("percentage_discount")
  reward4Value      String   @default("10")
  reward4Details    String?
  
  // ØªÙ‚ÙŠÙŠÙ… 3 Ù†Ø¬ÙˆÙ…
  reward3Type       String   @default("percentage_discount")
  reward3Value      String   @default("5")
  reward3Details    String?
  
  rewardExpiryDays  Int      @default(30)
  
  feedbacks         Feedback[]
  views             View[]
  dailyAnalytics    DailyAnalytics[]
  settings          BusinessSettings?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// ============= Business Settings =============
model BusinessSettings {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  businessId        String   @unique @db.ObjectId
  business          Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  
  whatsappPhone     String?
  googlePlaceId     String?
  googleReviewUrl   String?
  
  autoReply         String?
  autoReplyEnabled  Boolean  @default(false)
  
  emailNotification Boolean  @default(true)
  
  showVisitorName   Boolean  @default(true)
  showVisitorEmail  Boolean  @default(false)
  showVisitorPhone  Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// ============= Feedback Model =============
model Feedback {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  businessId        String   @db.ObjectId
  business          Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  
  rating            Int
  comment           String?
  
  visitorName       String?
  visitorEmail      String?
  visitorPhone      String?
  visitorIp         String?
  
  photos            String[] @default([])
  couponCode        String?
  
  status            String   @default("pending")
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([businessId])
  @@index([status])
  @@index([createdAt])
}

// ============= Coupon Model - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… =============
model Coupon {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  businessId    String   @db.ObjectId
  code          String   @unique
  
  // Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© ÙˆØ§Ù„Ù‚ÙŠÙ…Ø©
  rewardType    String   // "percentage_discount", "fixed_discount", "free_item", etc.
  rewardValue   String   // Ø§Ù„Ù‚ÙŠÙ…Ø© (Ù†Ø³Ø¨Ø©ØŒ Ù…Ø¨Ù„ØºØŒ Ø§Ø³Ù… Ù…Ù†ØªØ¬)
  rewardDetails String?  // ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©
  
  feedbackId    String?  @db.ObjectId
  customerName  String?
  customerPhone String?
  
  isUsed        Boolean  @default(false)
  isActive      Boolean  @default(true)
  usedAt        DateTime?
  
  expiresAt     DateTime
  createdAt     DateTime @default(now())
  
  @@index([businessId])
  @@index([isUsed])
  @@index([expiresAt])
}

// ============= View Model =============
model View {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  businessId        String   @db.ObjectId
  business          Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  
  visitorIp         String?
  userAgent         String?
  referrer          String?
  
  createdAt         DateTime @default(now())
  
  @@index([businessId])
  @@index([createdAt])
}

// ============= Daily Analytics =============
model DailyAnalytics {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  businessId        String   @db.ObjectId
  business          Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  
  date              DateTime
  
  views             Int      @default(0)
  feedbacks         Int      @default(0)
  avgRating         Float    @default(0)
  
  rating1           Int      @default(0)
  rating2           Int      @default(0)
  rating3           Int      @default(0)
  rating4           Int      @default(0)
  rating5           Int      @default(0)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@unique([businessId, date])
  @@index([businessId])
  @@index([date])
}

// ============= User Model =============
model User {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  email             String   @unique
  password          String
  name              String?
  
  ownedBusinesses   String[] @db.ObjectId
  
  isActive          Boolean  @default(true)
  emailVerified     Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}
